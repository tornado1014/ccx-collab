{% extends "base.html" %}

{% block title %}{{ _('stages') }}{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold">{{ _('stages') }}</h1>
    <p class="text-muted">Run individual pipeline stages with custom parameters</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for name, stage in stages.items() %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-5 hover:shadow-md transition-shadow"
         x-data="{ running: false, result: null }">
        <div class="flex items-center gap-2 mb-3">
            <span class="w-8 h-8 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30 text-primary text-sm font-bold">{{ loop.index }}</span>
            <h3 class="font-semibold text-lg capitalize">{{ name }}</h3>
        </div>
        <p class="text-sm text-muted mb-4">{{ stage.description }}</p>

        <div class="text-xs text-muted mb-3">
            <span class="font-medium">Required:</span>
            {% for f in stage.fields %}{% if f.required %}<code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{ f.name }}</code> {% endif %}{% endfor %}
        </div>

        <div class="flex gap-2">
            <a href="/stages/{{ name }}" class="inline-block px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                {{ _('run_stage') }}
            </a>
            <button class="px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-sm"
                    @click="result = null; running = true; fetch('/api/stages/{{ name }}/form').then(r => r.json()).then(d => { result = d; running = false; })">
                Info
            </button>
        </div>

        <template x-if="result">
            <div class="mt-3 p-2 bg-gray-50 dark:bg-gray-700 rounded text-xs" x-text="JSON.stringify(result.fields.map(f => f.name))"></div>
        </template>
    </div>
    {% endfor %}
</div>
{% endblock %}
