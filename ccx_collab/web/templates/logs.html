{% extends "base.html" %}

{% block title %}{{ _('logs') }}{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold">{{ _('logs') }}</h1>
    <p class="text-muted">Real-time application log viewer</p>
</div>

<div x-data="logViewer()" x-init="load()">
    <div class="flex gap-3 items-center mb-4">
        <select x-model="levelFilter" @change="load()"
                class="border rounded-lg px-3 py-2 bg-white dark:bg-gray-700 dark:border-gray-600 text-sm">
            <option value="">All Levels</option>
            <option value="DEBUG">DEBUG</option>
            <option value="INFO">INFO</option>
            <option value="WARNING">WARNING</option>
            <option value="ERROR">ERROR</option>
        </select>
        <button @click="load()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
            Refresh
        </button>
        <label class="flex items-center gap-1 text-sm">
            <input type="checkbox" x-model="autoScroll" class="mr-1">
            Auto-scroll
        </label>
        <span class="text-xs text-muted" x-text="'Total: ' + total"></span>
    </div>

    <div class="bg-gray-900 text-gray-100 rounded-lg p-4 font-mono text-xs max-h-[600px] overflow-y-auto" id="log-container">
        <template x-for="(entry, i) in logs" :key="i">
            <div class="py-0.5 border-b border-gray-800">
                <span class="inline-block w-16 text-right mr-2"
                      :class="{
                          'text-red-400': entry.level === 'ERROR',
                          'text-yellow-400': entry.level === 'WARNING',
                          'text-blue-400': entry.level === 'INFO',
                          'text-gray-500': entry.level === 'DEBUG',
                      }"
                      x-text="entry.level"></span>
                <span class="text-gray-500 mr-2" x-text="new Date(entry.timestamp * 1000).toLocaleTimeString()"></span>
                <span x-text="entry.message"></span>
            </div>
        </template>
        <template x-if="logs.length === 0">
            <p class="text-gray-500">No log entries yet.</p>
        </template>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function logViewer() {
    return {
        logs: [],
        total: 0,
        levelFilter: '',
        autoScroll: true,
        async load() {
            try {
                const params = new URLSearchParams();
                if (this.levelFilter) params.set('level', this.levelFilter);
                const resp = await fetch('/api/logs?' + params);
                const data = await resp.json();
                this.logs = data.logs;
                this.total = data.total;
                if (this.autoScroll) this.$nextTick(() => {
                    const el = document.getElementById('log-container');
                    if (el) el.scrollTop = el.scrollHeight;
                });
            } catch (e) { console.error(e); }
        }
    };
}
</script>
{% endblock %}
