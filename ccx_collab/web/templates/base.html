<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ccx-collab{% endblock %} - ccx-collab Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/sse.js"></script>
    {% block head %}{% endblock %}
</head>
<body>
    <header class="container">
        <nav>
            <ul>
                <li><a href="/" {% if request.url.path == '/' %}aria-current="page"{% endif %}><strong>ccx-collab</strong></a></li>
            </ul>
            <ul>
                <li><a href="/" {% if request.url.path == '/' %}aria-current="page"{% endif %}>Dashboard</a></li>
                <li><a href="/tasks" {% if '/tasks' in request.url.path %}aria-current="page"{% endif %}>Tasks</a></li>
                <li><a href="/history" {% if '/history' in request.url.path %}aria-current="page"{% endif %}>History</a></li>
                <li><a href="/settings/webhooks" {% if '/settings' in request.url.path %}aria-current="page"{% endif %}>Settings</a></li>
            </ul>
            <ul>
                <li>
                    <select class="lang-select" onchange="location.href='?lang='+this.value">
                        <option value="en" {% if request.query_params.get('lang', 'en') == 'en' %}selected{% endif %}>EN</option>
                        <option value="ko" {% if request.query_params.get('lang') == 'ko' %}selected{% endif %}>KO</option>
                    </select>
                </li>
                <li>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                        <span id="theme-icon">&#9790;</span>
                    </button>
                </li>
            </ul>
        </nav>
    </header>

    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <footer class="container">
        <hr>
        <p><small>ccx-collab v0.3.0</small></p>
    </footer>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('ccx-collab-theme', next);
            document.getElementById('theme-icon').textContent = next === 'dark' ? '\u2600' : '\u263E';
        }
        (function() {
            const saved = localStorage.getItem('ccx-collab-theme');
            if (saved) {
                document.documentElement.setAttribute('data-theme', saved);
                document.getElementById('theme-icon').textContent = saved === 'dark' ? '\u2600' : '\u263E';
            }
        })();
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
