{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold">Dashboard</h1>
    <p class="text-muted">Pipeline overview and quick actions</p>
</div>

<!-- Welcome Panel -->
{% if total_runs is none or total_runs == 0 %}
<div x-data="{ show: localStorage.getItem('ccx-welcome-dismissed') !== 'true' }"
     x-show="show" x-transition
     class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-8 mb-8 border border-blue-200 dark:border-blue-800">
    <div class="flex justify-between items-start mb-4">
        <div>
            <h2 class="text-2xl font-bold">{{ _('what_to_build') }}</h2>
            <p class="text-muted">Your AI-powered development assistant</p>
        </div>
        <button @click="show = false; localStorage.setItem('ccx-welcome-dismissed', 'true')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
    </div>
    <p class="mb-6">Describe what you want to build, review the AI's plan, and let it execute automatically.</p>
    <a href="/wizard" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-lg">
        {{ _('start_new') }} &rarr;
    </a>
</div>
{% endif %}

<div class="stats-grid">
    <div class="stat-card">
        <h2 class="text-3xl font-bold">{{ total_runs | default(0) }}</h2>
        <p class="text-muted">Total Runs</p>
    </div>
    <div class="stat-card">
        <h2 class="text-3xl font-bold">{{ status_counts.get('running', 0) if status_counts else 0 }}</h2>
        <p class="text-muted">Running</p>
    </div>
    <div class="stat-card">
        <h2 class="text-3xl font-bold">{{ status_counts.get('completed', 0) if status_counts else 0 }}</h2>
        <p class="text-muted">Completed</p>
    </div>
    <div class="stat-card">
        <h2 class="text-3xl font-bold">{{ status_counts.get('failed', 0) if status_counts else 0 }}</h2>
        <p class="text-muted">Failed</p>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <section>
        <div class="mb-6">
            <h2 class="text-xl font-semibold">Running Pipelines</h2>
            <p class="text-muted text-sm">Currently active pipeline executions</p>
        </div>
        {% if running_pipelines %}
        {% for run in running_pipelines %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6">
            <div class="font-semibold text-lg mb-4">
                <span class="badge badge-running">running</span>
                <strong>{{ run.work_id }}</strong>
            </div>
            <p>Stage: <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded">{{ run.current_stage or 'initializing' }}</code></p>
            <p><small class="text-muted">Started: {{ run.started_at or 'N/A' }}</small></p>
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                <a href="/pipeline/{{ run.id }}/monitor" class="inline-block px-4 py-2 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm">Monitor</a>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-muted">No pipelines currently running.</p>
        {% endif %}
    </section>

    <section>
        <div class="mb-6">
            <h2 class="text-xl font-semibold">Recent Completions</h2>
            <p class="text-muted text-sm">Latest pipeline results</p>
        </div>
        {% if recent_runs %}
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        <th class="px-4 py-3 text-left font-medium">Work ID</th>
                        <th class="px-4 py-3 text-left font-medium">Status</th>
                        <th class="px-4 py-3 text-left font-medium">Started</th>
                        <th class="px-4 py-3 text-left font-medium">Finished</th>
                    </tr>
                </thead>
                <tbody>
                    {% for run in recent_runs %}
                    <tr>
                        <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700"><a href="/history/{{ run.id }}" class="text-blue-600 hover:underline">{{ run.work_id }}</a></td>
                        <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700">
                            <span class="badge badge-{{ run.status }}">{{ run.status }}</span>
                        </td>
                        <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700"><small class="text-muted">{{ run.started_at or 'N/A' }}</small></td>
                        <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700"><small class="text-muted">{{ run.finished_at or 'N/A' }}</small></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">No completed runs yet.</p>
        {% endif %}
    </section>
</div>

<div class="quick-actions">
    <a href="/wizard" class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">{{ _('new_project') }}</a>
    <a href="/history" class="inline-block px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm">View History</a>
    <a href="/history/charts" class="inline-block px-4 py-2 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm">Analytics</a>
</div>
{% endblock %}
