{% extends "base.html" %}

{% block title %}Tasks{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold">Tasks</h1>
    <p class="text-muted">Manage pipeline task definitions</p>
</div>

<div class="quick-actions mb-6">
    <a href="/tasks/create" class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">Create New Task</a>
</div>

<div class="overflow-x-auto">
    <table class="w-full text-sm">
        <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
                <th class="px-4 py-3 text-left font-medium">Task ID</th>
                <th class="px-4 py-3 text-left font-medium">Title</th>
                <th class="px-4 py-3 text-left font-medium">Risk Level</th>
                <th class="px-4 py-3 text-left font-medium">Priority</th>
                <th class="px-4 py-3 text-left font-medium">Actions</th>
            </tr>
        </thead>
        <tbody id="task-list">
            {% for task in tasks | default([]) %}
            <tr id="task-row-{{ task.task_id }}">
                <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700"><code class="text-sm bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded">{{ task.task_id }}</code></td>
                <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700">{{ task.title | default('Untitled') }}</td>
                <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700">
                    {% if task.risk_level == 'high' %}
                    <span class="badge badge-failed">{{ task.risk_level }}</span>
                    {% elif task.risk_level == 'medium' %}
                    <span class="badge badge-cancelled">{{ task.risk_level }}</span>
                    {% else %}
                    <span class="badge badge-completed">{{ task.risk_level | default('low') }}</span>
                    {% endif %}
                </td>
                <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700">{{ task.priority | default('normal') }}</td>
                <td class="px-4 py-3 border-t border-gray-100 dark:border-gray-700">
                    <div class="quick-actions">
                        <a href="/tasks/{{ task.task_id }}" class="inline-block px-3 py-1.5 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 text-xs">View</a>
                        <a href="/pipeline/run?task={{ task.path }}" class="inline-block px-3 py-1.5 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 text-xs">Run</a>
                        <button class="px-3 py-1.5 border border-gray-400 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-xs"
                                hx-delete="/api/tasks/{{ task.task_id }}"
                                hx-target="#task-row-{{ task.task_id }}"
                                hx-swap="outerHTML"
                                hx-confirm="Delete task '{{ task.task_id }}'?">Delete</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
            {% if not tasks %}
            <tr>
                <td colspan="5" class="px-4 py-3 border-t border-gray-100 dark:border-gray-700 text-muted">No tasks found. <a href="/tasks/create" class="text-blue-600 hover:underline">Create one</a>.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
